<!doctype html>
<!--
@license
Copyright (c) 2014 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<html>
<head>
  <title>Polymer - shady</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="../../../webcomponentsjs/webcomponents-lite.js"></script>

  <link rel="import" href="../../src/shady/shady.html">
  <link rel="import" href="../../src/styling/style-lib.html">
</head>
<body>

  <template id="v1">
    <style>
    :host {
      display: block;
      --size: 8px;
      --padding: {
        padding: var(--size);
      };
    }
    .container {
      /*padding: 8px;*/
      @apply --padding;
      background: #ccc;
    }
    #slot {
      margin: var(--size);
      @apply --padding;
      /*margin: 8px;
      padding: 8px;*/
      background: beige;
    }
    </style>
    <div class="container">
      <header>header (v1)</header>
      <div id="slot">
        <slot></slot>
      </div>
      <footer>footer</footer>
    </div>
    <div id="last">last</div>
  </template>

  <script>
  HTMLImports.whenReady(function() {

    'use strict';

    var template = document.querySelector('template#v1');

    class XBaseV1 extends HTMLElement {

      attachedCallback() {
        if (!this.__stamped) {
          this.__stamped = true;
          Polymer.StyleLib.prepareHost(this, template);
          var dom = document.importNode(template.content, true);
          dom.__styleScoped = true;
          this.attachShadow({mode: 'open'}).appendChild(dom);
        }
        var d = document.createElement('div');
        d.textContent = 'dynamic';
        this.insertBefore(d, this.firstElementChild);
        var e = document.createElement('div');
        e.innerHTML = '[gray with padding]';
        e.classList.add('container');
        this.shadowRoot.appendChild(e);
        Polymer.StyleLib.applyStyle(this);
      }

    }

    Polymer.ShadyDom.addedNode = function(node, root) {
      Polymer.StyleTransformer.dom(node, root.host.localName);
    }

    Polymer.ShadyDom.removedNode = function(node, root) {
      Polymer.StyleTransformer.dom(node, root.host.localName, true);
    }

    document.registerElement('x-base-v1', XBaseV1);

    //Polymer.DomTreeMutation.patch(test);

  });

  </script>

  <template id="v0">
    <div style="padding: 8px; background: #ccc;">
      <header>header (v0)</header>
      <div style="margin: 8px; padding: 8px; background: beige;">
        <content></content>
      </div>
      <footer>footer</footer>
    </div>
  </template>

  <script>
  HTMLImports.whenReady(function() {

    'use strict';

    var template = document.querySelector('template#v0');

    class XBaseV0 extends HTMLElement {

      attachedCallback() {
        if (!this.__stamped) {
          this.__stamped = true;
          this.attachShadow({mode:'open'}).appendChild(
            document.importNode(template.content, true));
        }
        var d = document.createElement('div');
        d.textContent = 'dynamic';
        this.insertBefore(d, this.firstElementChild);
      }

    }

    document.registerElement('x-base-v0', XBaseV0);

  });

  </script>

  <x-base-v1 id="test">
    <div>light child</div>
  </x-base-v1>

  <br><hr><br>

  <x-base-v0>
    <div>light child</div>
  </x-base-v0>

  <template id="x-child">
    <style>
    #inner {
      @apply --inner;
    }
    </style>
    <div id="inner"></div>
  </template>
  <script>
  HTMLImports.whenReady(function() {
    'use strict';

    var template = document.querySelector('template#x-child');

    class XChild extends HTMLElement {
      attachedCallback() {
        if (!this.__stamped) {
          this.__stamped = true;
          Polymer.StyleLib.prepareHost(this, template);
          this.attachShadow({mode: 'open'}).appendChild(
            document.importNode(template.content, true)
          );
          Polymer.StyleLib.applyStyle(this);
        }
      }
    }
    document.registerElement('x-child', XChild);
  });
  </script>
  <template id="x-parent">
    <style>
    :host {
      --size: 20px;
      --inner: {
        background: blue;
        height: var(--size);
        width: var(--size);
      }
    }
    </style>
    <x-child></x-child>
  </template>
  <script>
  HTMLImports.whenReady(function() {
    'use strict';

    var template = document.querySelector('template#x-parent');

    class XParent extends HTMLElement {
      attachedCallback() {
        if (!this.__stamped) {
          this.__stamped = true;
          Polymer.StyleLib.prepareHost(this, template);
          this.attachShadow({mode: 'open'}).appendChild(
            document.importNode(template.content, true)
          );
          Polymer.StyleLib.applyStyle(this);
        }
      }
    }
    document.registerElement('x-parent', XParent);
  });
  </script>

  <x-parent></x-parent>

</body>
</html>

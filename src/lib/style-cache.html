<!--
@license
Copyright (c) 2014 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<script>

  Polymer.StyleCache = function(keyName) {
    this.cache = {};
    if (keyName) {
      this._keyName = keyName;
    }
  }

  Polymer.StyleCache.prototype = {
    
    MAX: 100,

    _keyName: '_cacheKey',

    store: function(is, style, keyProperties, keyStyles) {
      style[this._keyName] = {
        properties: keyProperties, 
        styles: keyStyles
      }
      var s$ = this.cache[is] = this.cache[is] || [];
      s$.push(style);
      if (s$.length > this.MAX) {
        s$.shift();
      }
    },

    retrieve: function(is, keyProperties, keyStyles) {
      var cache = this.cache[is];
      if (cache) {
        // look through cache backwards as most recent push is last.
        for (var i=cache.length-1, s; i >= 0; i--) {
          s = cache[i];
          key = s[this._keyName];
          if (this._objectsEqual(keyProperties, key.properties) &&
            keyStyles === key.styles) {
            return s;
          }
        }
      }
    },

    clear: function() {
      for (var i in this.cache) {
        for (var j=0; j< this.cache[i].length; j++) {
          this.cache[i][j][this._keyName] = null;
        }
      }
      this.cache = {};
    },

    // note, intentionally a simple check here, should be good enough
    _objectsEqual: function(target, source) {
      for (var i in target) {
        if (target[i] !== source[i]) {
          return false;
        }
      }
      return true;
    }

  };

</script>
<!--
/*
 * Copyright 2012 The Toolkitchen Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style
 * license that can be found in the LICENSE file.
 */
-->
<element name="g-panel-transition">
  <!-- remove blank template when polyfill issue #62 is fixed -->
  <template></template>
  <script>
    this.component({
      prototype: {
        transitionClass: 'transition',
        timeout: 1000,
        //* indicates only one panel should be displayed at a time.
        highlander: true,
        // TODO(sorvell): promote to g-component?
        get base() {
          return this.__proto__.__proto__;
        },
        setup: function(inPanels) {
          this.panels = inPanels;
          inPanels.getPanels().forEach(function(p, i) {
            p.classList.add(this.transitionClass);
            p.hidden = this.highlander && (i != inPanels.index);
          }, this);
          this.finishListener = this.finish.bind(this);
        },
        teardown: function() {
          this.panels.getPanels().forEach(function(p, i) {
            p.classList.remove(this.transitionClass);  
            p.style.opacity = p.style.webkitTransform = null;
            if (this.highlander) {
              p.hidden = false;
            };
          }, this);
        },
        go: function(inFrom, inTo, inForward) {
          this.from = inFrom;
          this.to = inTo;
          this.forward = inForward;
          this._transitioning = setTimeout(this.finishListener, this.timeout);
          this.begin(inFrom, inTo, inForward);
        },
        finish: function() {
          if (this._transitioning) {
            this.complete(); 
          }
          this.cancel();
          this.panels.finishTransition();
        },
        cancel: function() {
          clearTimeout(this._transitioning);
          this._transitioning = null;
        },
        stop: function() {
          this.finish();
        },
        // transitions typically override begin/complete
        begin: function() {
        },
        complete: function() {
        }
      }
    });
  </script>
</element>


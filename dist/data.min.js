Base.addFeature({register:function(e){e._addPropertyBindEffects()},addPropertyEffect:function(e,t,n){this._propertyEffects={};this._addPropertyEffect(e,t,n);this.addPropertyEffect=this._addPropertyEffect},_addPropertyEffect:function(e,t,n){var r=this._propertyEffects[e];if(!r){r=this._propertyEffects[e]=[]}r.push({kind:t,effect:n})},_addPropertyBindEffects:function(){for(var e in this.bind){var t=this.bind[e];if(typeof t==="object"){for(var n in t){this._addPropertyBindEffect(e,t[n])}}else{this._addPropertyBindEffect(e,t)}}},_addPropertyBindEffect:function(e,t){this.addPropertyEffect(e,"bind",t)}});Base.addFeature({findAnnotatedNode:function(e,t){if(!t.parent){return e}var n=this.findAnnotatedNode(e,t.parent);var r=n===this?n.childNodes:n.lightChildren||n.childNodes;return r[t.index]},register:function(e){if(e._template){e.parseAnnotations(e._template)}},parseAnnotations:function(e){var t=[];this._parseNodeAnnotations(e.content,t);if(t.length){e.map=t}return e.map},_parseNodeAnnotations:function(e,t){return e.nodeType===Node.TEXT_NODE?this._parseTextNodeAnnotation(e,t):this._parseElementAnnotations(e,t)},_parseTextNodeAnnotation:function(e,t){var n=e.textContent,r=n.slice(0,2);if(r==="{{"||r==="[["){var i={bindings:[{kind:"text",mode:r==="{{"?"auto":"",value:n.slice(2,-2)}]};t.push(i);return i}},_parseElementAnnotations:function(e,t){var n={bindings:[],events:[]};this._parseChildNodesAnnotations(e,n,t);if(e.attributes){this._parseNodeAttributeAnnotations(e,n,t)}if(n.bindings.length||n.events.length||n.id){t.push(n)}return n},_parseChildNodesAnnotations:function(e,t,n){if(e.firstChild){for(var r=0,i=e.firstChild;i;i=i.nextSibling,r++){var s=this._parseNodeAnnotations(i,n);if(s){s.parent=t;s.index=r}}}},_parseNodeAttributeAnnotations:function(e,t){for(var n=0,r;r=e.attributes[n];n++){var i=r.name,s=r.value;if(i==="id"){t.id=s}else if(i.slice(0,3)==="on-"){t.events.push({name:i.slice(3),value:s})}else{var o=this._parseNodeAttributeAnnotation(e,i,s);if(o){t.bindings.push(o)}}}},_parseNodeAttributeAnnotation:function(e,t,n){var r=n.slice(0,2),i=t[t.length-1];var s="attribute",o="";if(i==="*"||i===":"){t=t.slice(0,-1);s="property";o="auto"}if(r==="{{"){o="auto";n=n.slice(2,-2)}if(r==="[["){o="manual";n=n.slice(2,-2)}if(o){if(t==="style"){s="style"}return{kind:s,mode:o,name:t,value:n}}}});Base.addFeature({register:function(e){if(e._template&&e._template.map){this._preprocessBindAnnotations(e,e._template.map)}},_preprocessBindAnnotations:function(e,t){e._nodes=[];t.forEach(function(t){var n=e._nodes.push(t)-1;t.bindings.forEach(function(t){e._bindAnnotationBinding(t,n)})})},_bindAnnotationBinding:function(e,t){e.index=t;this.addPropertyEffect(e.value,"annotation",e)}});Base.addFeature({computed:{},register:function(e){e.defineComputedProperties(e.computed)},defineComputedProperties:function(e){for(var t in e){this.defineComputedProperty(t,e[t])}},defineComputedProperty:function(e,t){var n=t.indexOf("(");var r=t.slice(0,n);var i=t.slice(n+1,-1).replace(/ /g,"").split(",");console.log("%c on [%s] compute [%s] via [%s]","color: green",i[0],e,r);this.addPropertyEffect(i[0],"compute",{property:e,method:r})}});Base.addFeature({init:function(){this._data=Object.create(null)},_setupBindListeners:function(){var e=this._bindListeners;for(var t in e){e[t].targets.forEach(function(e){this._setupBindListener(t,e)},this)}},_setupBindListener:function(e,t){var n=this,e;var r=t.id?this.$[t.id]:this._nodes[t.index];r.addEventListener(t.property+"-changed",function(t){n[e]=t.detail})},_notifyChange:function(e){this.fire(e+"-changed",this[e],null,false)},_setData:function(e,t){var n=this._data[e];if(n!==t){this._data[e]=t}return n},register:function(e){e._bindListeners={};e._createBindings()},_createBindings:function(){var e=this._propertyEffects;for(var t in e){var n=e[t].map(function(e){return this._buildEffect(t,e)},this);this._bindPropertyEffects(t,n)}},_buildEffect:function(e,t){return this["_"+t.kind+"EffectBuilder"](e,t.effect)},_bindEffectBuilder:function(e,t){if(typeof this[t]==="function"){return"this."+t+"(this._data."+e+", old);"}var n=t.split(".");var r=n.shift();var i=n.join(".");if(i){this._addBindListener(e,r,i)}else{i="textContent"}return"this.$."+r+"."+i+" = "+"this._data."+e+";"},_bindPropertyEffects:function(e,t){var n={get:function(){return this._data[e]}};if(t.length){t=t.join("\n		");var r="_"+e+"Effector";this[r]=new Function("old",t);var i="	var old = this._setData('"+e+"', value);\n"+"	if (value !== old) {\n"+"		this."+r+"(old);\n"+"	}";var s=new Function("value",i);if(this.isReadOnlyProperty(e)){this["_set_"+e]=s}else{n.set=s}}Object.defineProperty(this,e,n)},_notifyEffectBuilder:function(e){return"this._notifyChange('"+e+"')"},_computeEffectBuilder:function(e,t){return"this."+t.property+" = this."+t.method+"(this._data."+e+");"},_annotationEffectBuilder:function(e,t){var n=t.name||"textContent";if(t.kind!=="text"&&t.kind!=="attribute"){console.warn(t.kind);return}if(n!=="textContent"){this._addAnnotatedListener(e,t.index,n)}return this._bindAnnotationProperty(e,n,t.index)},_bindAnnotationProperty:function(e,t,n){return"this._nodes["+n+"]."+t+" = this._data."+e+";"},_addBindListener:function(e,t,n){var r=this._requireBindListeners(e);r.targets.push({id:t,property:n})},_addAnnotatedListener:function(e,t,n){var r=this._requireBindListeners(e);r.targets.push({index:t,property:n})},_requireBindListeners:function(e){var t=this._bindListeners[e];if(!t){t=this._bindListeners[e]={targets:[]}}return t}})